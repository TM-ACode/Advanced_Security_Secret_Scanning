name: Database passwords

patterns:
  - name: Database Connection String (1)
    type: database_connection_string
    description: "Database connection strings are used to connect to databases, often with embedded credentials."
    regex:
      pattern: |
        [^;"\x00-\x08]+
      start: |
        "(([Ss]erver|[Pp]rovider|[Dd]atabase|User Id|Data Source|Endpoint|DefaultEndPointsProtocol|AccountName|DataSource|Authentication|Login|InitialCatalog|DB|Trusted_Connection|authenticationType|DSN|DataSourceName|IntegratedSecurity|Location|Encrypt|System|Protocol|Host|Port|SRVR|Driver|Dbq|SslMode|SSL|Uid|DBNAME|SystemDB|Persist Security Info|Connection Type|DataSourceName|Excel File|Server Name|URL)=[^"]+;)([Pp]assword|[Pp]wd|SharedSecretValue|AccountKey|pw|PW|Cipher Key|OAuth Access Token Secret)=
      end: |
        ;
      additional_not_match:
        # placeholders
        - ^(%(.*)?s|\$[a-zA-Z_]+|<[a-zA-Z_]+>|\{[a-zA-Z_]+\}|\[[a-zA-Z_]+\]|%[A-Z_]+%|\.\*)$
        # parameterized query
        - parameters\('[^']+'\)

    comments:
      - This will spot connection strings for many databases, including MySQL, PostgreSQL, Oracle, SQL Server
      - To cut FPs, we require the start of the string to be a database-specific keyword

  - name: Database Connection String (2)
    type: database_connection_string
    description: "Database connection strings are used to connect to databases, often with embedded credentials."
    regex:
      pattern: |
        [^;"\x00-\x08]+
      start: |
        (?i)"(Password|Pwd|SharedSecretValue|AccountKey|PW|Cipher Key|OAuth Access Token Secret)=
      end: |
        ";[^";]*((Server|Provider|Database|User Id|Data Source|Endpoint|DefaultEndPointsProtocol|AccountName|DataSource|Authentication|Login|InitialCatalog|DB|Trusted_Connection|authenticationType|DSN|DataSourceName|IntegratedSecurity|Location|Encrypt|System|Protocol|Host|Port|SRVR|Driver|Dbq|SslMode|SSL|Uid|DBNAME|SystemDB|Persist Security Info|Connection Type|DataSourceName|Excel File|Server Name|URL)=
      additional_not_match:
        # placeholders
        - ^(%(.*)?s|\$[a-zA-Z_]+|<[a-zA-Z_]+>|\{[a-zA-Z_]+\}|\[[a-zA-Z_]+\]|%[A-Z_]+%|\.\*)$
        # parameterized query
        - parameters\('[^']+'\)

    comments:
      - This will spot connection strings for many databases, including MySQL, PostgreSQL, Oracle, SQL Server
      - To cut FPs, we require part of the string after the password to be a database-specific keyword
